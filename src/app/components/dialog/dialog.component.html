<form [formGroup]="formGroup" (ngSubmit)="onSubmit()" class="form">

  <h1>{{ isEditMode ? 'Edit ' + initialCampaignName : 'Create alert rule' }}</h1>

  <div class="form-row">
    <mat-form-field class="form-element">
      <mat-label>Partner</mat-label>
      <input type="text" placeholder="Select your partner" formControlName="partner" aria-label="partner" matInput [matAutocomplete]="partnersAuto">
      <mat-autocomplete #partnersAuto="matAutocomplete" (optionSelected)="getAdvertiser($event)" [displayWith]="displayFn">
        <mat-option *ngFor="let partner of partners$ | async" [value]="partner">
          {{ partner.displayName }}
        </mat-option>
      </mat-autocomplete>
    </mat-form-field>

    <mat-form-field class="form-element">
      <mat-label>Advertiser</mat-label>
      <input type="text" placeholder="Select your advertiser" formControlName="advertiser" aria-label="advertiser" matInput [matAutocomplete]="advertisersAuto">
      <mat-autocomplete #advertisersAuto="matAutocomplete" (optionSelected)="getCampaign($event)" [displayWith]="displayFn">
        <mat-option *ngFor="let advertiser of advertisers$ | async" [value]="advertiser">
          {{ advertiser.displayName }}
        </mat-option>
      </mat-autocomplete>
    </mat-form-field>
  </div>

  <div class="form-row">
    <mat-form-field class="form-element">
      <mat-label>Campaign Name</mat-label>
      <input matInput formControlName="campaignName" required>
          <mat-error *ngIf="(submitted || form['campaignName'].touched) && form['campaignName'].invalid">
              The field is required
          </mat-error>
    </mat-form-field>

    <mat-form-field class="form-element">
      <mat-label>Campaign Id</mat-label>
      <input type="text" placeholder="Select your campaign" formControlName="campaignId" aria-label="Campaign Id" matInput [matAutocomplete]="campaignsAuto">
      <mat-autocomplete #campaignsAuto="matAutocomplete" [displayWith]="displayFn" (optionSelected)="autoCompleteCampaign($event)">
        <mat-option *ngFor="let campaign of campaigns$ | async" [value]="campaign">
          {{ campaign.displayName }} | {{ campaign.campaignId }}
        </mat-option>
      </mat-autocomplete>
      <mat-error *ngIf="(submitted || form['campaignName'].touched) && form['campaignName'].invalid">
          The field is required
      </mat-error>
    </mat-form-field>
  </div>

  <div class="form-row">
    <mat-form-field class="form-element">
        <mat-label>Start Date</mat-label>
        <input matInput [matDatepicker]="startPicker" formControlName="startDate">
        <mat-hint>MM/DD/YYYY</mat-hint>
        <mat-datepicker-toggle matIconSuffix [for]="startPicker"></mat-datepicker-toggle>
        <mat-datepicker #startPicker></mat-datepicker>
        <mat-error *ngIf="form['startDate'].errors?.['required']">
            This field is required.
        </mat-error>
        <mat-error *ngIf="form['startDate'].errors?.['invalidDate']">
          Please enter a valid date.
        </mat-error>
    </mat-form-field>
    
    <mat-form-field class="form-element">
        <mat-label>End Date</mat-label>
        <input matInput [matDatepicker]="endPicker" formControlName="endDate">
        <mat-hint>MM/DD/YYYY</mat-hint>
        <mat-datepicker-toggle matIconSuffix [for]="endPicker"></mat-datepicker-toggle>
        <mat-datepicker #endPicker></mat-datepicker>
        <mat-error *ngIf="form['endDate'].errors?.['required']">
          This field is required.
        </mat-error>
        <mat-error *ngIf="form['endDate'].errors?.['invalidDate']">
          Please enter a valid date.
        </mat-error>
        <mat-error *ngIf="form['endDate'].errors?.['dateMismatch']">
          End date must be after or equal to start date.
        </mat-error>
    </mat-form-field>
  </div>

  <div class="form-row budget-row">
    <mat-form-field class="form-element">
      <mat-label>Budget</mat-label>
      <input matInput formControlName="budget">
      <mat-error *ngIf="form['budget'].errors?.['required'] && (submitted || form['budget'].touched)">
          The field is required
      </mat-error>
      <mat-error *ngIf="form['budget'].errors?.['pattern'] && (submitted || form['budget'].touched)">
          Please enter a valid number
      </mat-error>
    </mat-form-field>
  </div>

	<div class="form-element">
		<button mat-raised-button type="submit" class="button" color="primary">{{ isEditMode ? 'Edit' : 'Create' }}</button>
    &nbsp;
		<button mat-raised-button class="button" (click)="onCancel()">Cancel</button>
  </div>

</form>